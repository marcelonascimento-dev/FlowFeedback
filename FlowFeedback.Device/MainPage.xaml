<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:FlowFeedback.Device.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="FlowFeedback.Device.MainPage"
             BackgroundColor="#F5F6F8"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto, *">

        <Grid Grid.Row="0" HeightRequest="300"
      RowDefinitions="*,Auto,Auto">

            <!-- FUNDO AZUL -->
            <Border Grid.RowSpan="3" StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="0,0,40,40" />
                </Border.StrokeShape>

                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="{DynamicResource Primary}" Offset="0.0" />
                        <GradientStop Color="{DynamicResource PrimaryDark}" Offset="1.0" />
                    </LinearGradientBrush>
                </Border.Background>
            </Border>

            <!-- CONTEÚDO CENTRAL -->
            <VerticalStackLayout Grid.Row="0"
        Padding="0,24,0,0"
        Spacing="8"
        HorizontalOptions="Center"
        VerticalOptions="Center">

                <Image Source="{Binding LogoUrl, TargetNullValue='dotnet_bot.png'}"
               HeightRequest="70"
               Aspect="AspectFit"/>

                <Label Text="QUAL A SUA OPINIÃO?"
               FontSize="28"
               FontAttributes="Bold"
               TextColor="White"
               HorizontalTextAlignment="Center"/>

                <Label Text="Sua avaliação ajuda o MAX Supermercados a melhorar todos os dias!"
               FontSize="15"
               TextColor="White"
               Opacity="0.9"
               HorizontalTextAlignment="Center"/>
            </VerticalStackLayout>

            <!-- FAIXA CTA -->
            <Border Grid.Row="1"
            HeightRequest="48"
            HorizontalOptions="Center"
            BackgroundColor="#D71920"
            Padding="24,0"
            StrokeThickness="0"
            Margin="0,12,0,12">

                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="24" />
                </Border.StrokeShape>

                <Border.Shadow>
                    <Shadow Brush="Black"
                    Offset="0,4"
                    Radius="10"
                    Opacity="0.25"/>
                </Border.Shadow>

                <Label Text="PARTICIPE E NOS AJUDE A CRESCER!"
               FontSize="14"
               FontAttributes="Bold"
               TextColor="White"
               VerticalOptions="Center"
               HorizontalOptions="Center"/>
            </Border>

            <!-- CURVA DE TRANSIÇÃO -->
            <BoxView Grid.Row="2"
             HeightRequest="40"
             BackgroundColor="#F5F6F8"
             CornerRadius="40"/>
        </Grid>




        <CollectionView Grid.Row="1" 
                        ItemsSource="{Binding Alvos}" 
                        Margin="20,10,20,20"
                        SelectionMode="None"
                        VerticalScrollBarVisibility="Never"
                        HorizontalScrollBarVisibility="Never">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" 
                                 Span="2" 
                                 HorizontalItemSpacing="20" 
                                 VerticalItemSpacing="20" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="viewmodel:AlvoDto">
                    <Border StrokeThickness="0"
                BackgroundColor="#F8FAFD"
                HeightRequest="320">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="30" />
                        </Border.StrokeShape>

                        <Border.Shadow>
                            <Shadow Brush="Black"
                        Offset="0,10"
                        Radius="18"
                        Opacity="0.08" />
                        </Border.Shadow>

                        <Border.GestureRecognizers>
                            <TapGestureRecognizer 
                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:MainViewModel}}, Path=AbrirVotacaoCommand}"
                    CommandParameter="{Binding .}" />
                        </Border.GestureRecognizers>

                        <Grid RowDefinitions="*,Auto" Padding="20">

                            <!-- CONTEÚDO -->
                            <VerticalStackLayout Spacing="14" VerticalOptions="Center">

                                <!-- Avatar -->
                                <Border HeightRequest="110"
                            WidthRequest="110"
                            HorizontalOptions="Center"
                            StrokeThickness="4"
                            Stroke="{DynamicResource Primary}"
                            BackgroundColor="White">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="55" />
                                    </Border.StrokeShape>

                                    <Image Source="{Binding ImagemUrl, TargetNullValue='dotnet_bot.png'}"
                               Aspect="AspectFill"/>
                                </Border>

                                <!-- Título -->
                                <Label Text="{Binding Titulo}"
                           FontSize="22"
                           FontAttributes="Bold"
                           TextColor="#1F2D3D"
                           HorizontalTextAlignment="Center"/>

                                <!-- Subtítulo -->
                                <Label Text="{Binding Subtitulo}"
                           FontSize="15"
                           TextColor="#6B7C93"
                           HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>

                            <!-- BOTÃO AVALIAR -->
                            <Border Grid.Row="1"
                        Margin="0,20,0,0"
                        HeightRequest="56"
                        BackgroundColor="{DynamicResource Primary}"
                        StrokeThickness="0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="18" />
                                </Border.StrokeShape>

                                <HorizontalStackLayout Spacing="10"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center">

                                    <Label Text="👍"
                               FontSize="20"
                               TextColor="White"/>

                                    <Label Text="AVALIAR"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="White"/>
                                </HorizontalStackLayout>
                            </Border>

                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>