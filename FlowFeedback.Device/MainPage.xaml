<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:FlowFeedback.Device.ViewModels"
             x:Class="FlowFeedback.Device.MainPage"
             BackgroundColor="#F5F6F8"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,*">
        <Grid Grid.Row="0"
              HeightRequest="220"
              RowDefinitions="*,Auto">

            <!-- Fundo -->
            <Border StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="0,0,40,40"/>
                </Border.StrokeShape>

                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="{DynamicResource Primary}" Offset="0"/>
                        <GradientStop Color="{DynamicResource PrimaryDark}" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
            </Border>
            <VerticalStackLayout
                Padding="0,24"
                Spacing="10"
                HorizontalOptions="Center"
                VerticalOptions="Center">

                <Image Source="{Binding LogoUrl, TargetNullValue='dotnet_bot.png'}"
                       HeightRequest="64"
                       Aspect="AspectFit"/>

                <Label Text="QUAL A SUA OPINIÃO?"
                       FontSize="34"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalTextAlignment="Center"/>

                <Label Text="Sua avaliação ajuda o MAX Supermercados a melhorar todos os dias"
                       FontSize="16"
                       TextColor="White"
                       Opacity="0.9"
                       HorizontalTextAlignment="Center"/>
            </VerticalStackLayout>

            <!-- CTA -->
            <Border Grid.Row="1"
                    HeightRequest="44"
                    Padding="36,0"
                    BackgroundColor="#D71920"
                    HorizontalOptions="Center"
                    Margin="0,8,0,16">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="22"/>
                </Border.StrokeShape>

                <Label Text="TOQUE PARA COMEÇAR"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"/>
            </Border>
        </Grid>

        <!-- ===================== -->
        <!-- LISTA DE ATENDENTES -->
        <!-- ===================== -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Alvos}"
                        Margin="28,20"
                        SelectionMode="None"
                        VerticalScrollBarVisibility="Never">

            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical"
                                 Span="2"
                                 HorizontalItemSpacing="28"
                                 VerticalItemSpacing="28"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="viewmodel:AlvoDto">

                    <!-- CARD -->
                    <Border HeightRequest="360"
                            BackgroundColor="#F8FAFD"
                            StrokeThickness="0">

                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="30"/>
                        </Border.StrokeShape>

                        <Border.Shadow>
                            <Shadow Brush="Black"
                                    Offset="0,10"
                                    Radius="20"
                                    Opacity="0.08"/>
                        </Border.Shadow>

                        <Border.GestureRecognizers>
                            <TapGestureRecognizer
                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:MainViewModel}},
                                                  Path=SelecionarAlvoCommand}"
                                CommandParameter="{Binding .}"/>
                        </Border.GestureRecognizers>

                        <Grid Padding="24"
                              RowDefinitions="*,Auto">

                            <!-- Conteúdo -->
                            <VerticalStackLayout
                                Spacing="16"
                                VerticalOptions="Center">

                                <!-- Avatar -->
                                <Grid WidthRequest="130"
                                      HeightRequest="130"
                                      HorizontalOptions="Center">

                                    <Border StrokeThickness="4"
                                            Stroke="{DynamicResource Primary}"
                                            BackgroundColor="White">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="65"/>
                                        </Border.StrokeShape>
                                    </Border>

                                    <Image Source="{Binding ImagemUrl, TargetNullValue='dotnet_bot.png'}"
                                           Aspect="AspectFill">
                                        <Image.Clip>
                                            <EllipseGeometry
                                                Center="65,65"
                                                RadiusX="65"
                                                RadiusY="65"/>
                                        </Image.Clip>
                                    </Image>
                                </Grid>

                                <!-- Nome -->
                                <Label Text="{Binding Titulo}"
                                       FontSize="24"
                                       FontAttributes="Bold"
                                       TextColor="#0F172A"
                                       HorizontalTextAlignment="Center"/>

                                <!-- Cargo -->
                                <Label Text="{Binding Subtitulo}"
                                       FontSize="16"
                                       TextColor="#64748B"
                                       HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>

                            <!-- BOTÃO -->
                            <Border Grid.Row="1"
                                    HeightRequest="64"
                                    BackgroundColor="{DynamicResource Primary}"
                                    Margin="0,24,0,0">

                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="22"/>
                                </Border.StrokeShape>

                                <HorizontalStackLayout
                                    Spacing="12"
                                    HorizontalOptions="Center"
                                    VerticalOptions="Center">

                                    <Label Text="👍"
                                           FontSize="22"
                                           TextColor="White"/>

                                    <Label Text="TOCAR PARA AVALIAR"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="White"/>
                                </HorizontalStackLayout>
                            </Border>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>